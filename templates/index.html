<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">🔒 사내 메신저 (E2E 암호화)</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="/static/js/socket.io.min.js"></script>
    <script src="/static/js/crypto-js.min.js"></script>
</head>

<body>
    <!-- [v4.34] 스킵 링크 (접근성) -->
    <a href="#messagesContainer" class="skip-link">메인 콘텐츠로 건너뛰기</a>

    <!-- [v4.34] 스크린 리더용 알림 영역 -->
    <div id="srAnnouncements" aria-live="polite" aria-atomic="true" class="visually-hidden"></div>

    <!-- 인증 화면 -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <h1>🔒 사내 메신저</h1>
            <p class="subtitle">종단간 암호화로 안전하게 소통하세요</p>
            <div style="text-align:center;"><span class="encryption-badge">🔒 E2E 암호화 적용</span></div>
            <div id="authError" class="error-message hidden"></div>

            <!-- 로그인 폼 -->
            <form id="loginForm" onsubmit="return false;">
                <div class="form-group">
                    <label>아이디</label>
                    <input type="text" id="loginUsername" placeholder="아이디를 입력하세요" required>
                </div>
                <div class="form-group">
                    <label>비밀번호</label>
                    <input type="password" id="loginPassword" placeholder="비밀번호를 입력하세요" required>
                </div>
                <button type="button" class="btn btn-primary" id="loginBtn">로그인</button>
            </form>

            <!-- 회원가입 폼 -->
            <form id="registerForm" class="hidden" onsubmit="return false;">
                <!-- [v4.34] 회원가입 단계 표시기 -->
                <div class="step-indicator" id="stepIndicator">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">아이디</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">비밀번호</div>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">닉네임</div>
                    </div>
                </div>

                <div class="form-group" data-step="1">
                    <label>아이디</label>
                    <input type="text" id="regUsername" placeholder="3자 이상" required aria-label="아이디 입력"
                        onfocus="updateStepIndicator(1)" onblur="validateStep(1)">
                </div>
                <div class="form-group" data-step="2">
                    <label>비밀번호</label>
                    <input type="password" id="regPassword" placeholder="8자 이상 (영문+숫자)" required
                        oninput="updatePasswordStrength(this.value)" aria-label="비밀번호 입력"
                        aria-describedby="passwordStrength" onfocus="updateStepIndicator(2)" onblur="validateStep(2)">
                    <!-- [v4.33] 패스워드 강도 표시기 -->
                    <div id="passwordStrength" class="password-strength" style="display:none">
                        <div class="strength-bar-container">
                            <div class="strength-bar"></div>
                            <div class="strength-bar"></div>
                            <div class="strength-bar"></div>
                            <div class="strength-bar"></div>
                        </div>
                        <span class="strength-label"></span>
                    </div>
                </div>
                <div class="form-group" data-step="3">
                    <label>닉네임</label>
                    <input type="text" id="regNickname" placeholder="표시될 이름" aria-label="닉네임 입력"
                        onfocus="updateStepIndicator(3)" onblur="validateStep(3)">
                </div>
                <button type="button" class="btn btn-primary" id="registerBtn">회원가입</button>
            </form>

            <div class="auth-switch">
                <span id="switchToRegisterWrap">계정이 없으신가요? <a href="javascript:void(0)"
                        id="showRegister">회원가입</a></span>
                <span id="switchToLoginWrap" style="display:none">이미 계정이 있으신가요? <a href="javascript:void(0)"
                        id="showLogin">로그인</a></span>
            </div>
        </div>
    </div>

    <!-- 메인 앱 -->
    <div id="appContainer" class="app-container">
        <!-- 사이드바 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>🔒 대화</h2>
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="대화 검색...">
                </div>
            </div>
            <div class="room-list" id="roomList" role="list" aria-label="대화방 목록"></div>
            <!-- [v4.33] 접기/펴기 가능한 온라인 섹션 -->
            <div class="online-section" id="onlineSection">
                <div class="online-section-header" onclick="toggleOnlineSection()" role="button" aria-expanded="true"
                    aria-controls="onlineUsersList">
                    <h4><span class="dot"></span> 온라인 사용자</h4>
                    <span class="online-section-toggle">▼</span>
                </div>
                <div class="online-users-list" id="onlineUsersList" role="list" aria-label="온라인 사용자 목록"></div>
            </div>
            <div class="user-section">
                <div class="user-avatar clickable" id="userAvatar" title="프로필 수정"></div>
                <div class="user-info clickable" id="userInfoClick" title="프로필 수정">
                    <div class="user-name" id="userName"></div>
                    <div class="user-status">온라인</div>
                </div>
                <div class="user-actions">
                    <button class="icon-btn" id="helpBtn" title="도움말">❓</button>
                    <button class="icon-btn" id="settingsBtn" title="화면 설정">🎨</button>
                    <button class="icon-btn" id="profileBtn" title="프로필 수정">👤</button>
                    <button class="icon-btn" id="newChatBtn" title="새 대화">➕</button>
                    <button class="icon-btn" id="logoutBtn" title="로그아웃">🚪</button>
                </div>
            </div>
        </div>

        <!-- 채팅 영역 -->
        <div class="chat-area" id="chatArea">
            <div class="empty-state empty-state-enhanced" id="emptyState">
                <div class="empty-illustration">💬</div>
                <h3>대화를 선택하세요</h3>
                <p>왼쪽에서 대화를 선택하거나<br>새 대화를 시작하세요</p>
                <div class="empty-actions">
                    <button class="btn btn-primary" onclick="openNewChatModal()">➕ 새 대화 시작</button>
                </div>
                <p style="margin-top:24px;font-size:12px;color:var(--text-muted);">
                    <span class="kbd">Ctrl</span>+<span class="kbd">N</span> 으로 빠르게 시작
                </p>
            </div>

            <div id="chatContent" class="chat-content hidden">
                <div class="chat-header">
                    <button class="icon-btn mobile-menu-btn" id="mobileMenuBtn">☰</button>
                    <div class="chat-header-info">
                        <div class="chat-header-avatar" id="chatAvatar"></div>
                        <div>
                            <div class="chat-header-name" id="chatName">🔒</div>
                            <div class="chat-header-status" id="chatStatus"></div>
                        </div>
                    </div>
                    <div class="chat-header-actions">
                        <button class="icon-btn" id="roomSettingsBtn" title="설정">⚙</button>
                        <div class="dropdown-menu" id="roomSettingsMenu">
                            <div class="dropdown-item" id="editRoomNameBtn">✏ 대화방 이름 변경</div>
                            <div class="dropdown-item" id="pinRoomBtn">📌 <span id="pinRoomText">상단 고정</span></div>
                            <div class="dropdown-item" id="muteRoomBtn">🔕 <span id="muteRoomText">알림 끄기</span></div>
                            <div class="dropdown-item" id="viewMembersBtn">👥 멤버 보기</div>
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-item" id="createPollBtn2">📋 투표 만들기</div>
                            <div class="dropdown-item" id="viewFilesBtn">📁 파일 저장소</div>
                            <div class="dropdown-item" id="viewPinsBtn">📌 공지 보기</div>
                            <div class="dropdown-item" id="adminSettingsBtn">👑 관리자 설정</div>
                        </div>
                        <button class="icon-btn" id="inviteBtn" title="초대">👤➕</button>
                        <button class="icon-btn" id="leaveRoomBtn" title="나가기">🚪</button>
                    </div>
                </div>
                <!-- 공지 배너 -->
                <div class="pinned-banner hidden" id="pinnedBanner">
                    <span class="pinned-icon">📌</span>
                    <span class="pinned-content" id="pinnedContent">공지사항이 여기에 표시됩니다</span>
                    <button class="pinned-close" id="closePinnedBanner">✕</button>
                </div>
                <div class="messages-container drop-zone" id="messagesContainer">
                    <div class="drop-overlay" id="dropOverlay">
                        <div class="drop-overlay-content">
                            <div class="drop-overlay-icon">📁</div>
                            <div class="drop-overlay-text">파일을 놓아 업로드</div>
                        </div>
                    </div>
                </div>
                <button class="scroll-to-bottom-btn hidden" id="scrollToBottomBtn" title="맨 아래로">↓</button>
                <div class="typing-indicator hidden" id="typingIndicator"></div>
                <div id="replyPreview" class="hidden"></div>
                <div class="chat-input-container">
                    <div class="encryption-notice">🔒 메시지는 종단간 암호화됩니다</div>
                    <div class="chat-input-wrapper">
                        <div class="chat-input-actions">
                            <button class="icon-btn" id="emojiBtn">😊</button>
                            <button class="icon-btn" id="attachBtn">📎</button>
                            <input type="file" id="fileInput" style="display:none;">
                            <div class="emoji-picker" id="emojiPicker"></div>
                        </div>
                        <div class="mention-autocomplete hidden" id="mentionAutocomplete"></div>
                        <textarea class="chat-input" id="messageInput" placeholder="메시지를 입력하세요... (@로 멘션)"
                            rows="1"></textarea>
                        <button class="send-btn" id="sendBtn">✉</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 새 대화 모달 -->
    <div class="modal-overlay" id="newChatModal" role="dialog" aria-modal="true" aria-labelledby="newChatModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="newChatModalTitle">새 대화 시작</h3>
                <button class="modal-close" id="closeNewChatModal">✕</button>
            </div>
            <div class="form-group">
                <label>대화방 이름 (그룹 채팅 시)</label>
                <input type="text" id="roomName" placeholder="대화방 이름">
            </div>
            <div class="form-group"><label>참여자 선택</label></div>
            <div class="user-list" id="userList"></div>
            <button class="btn btn-primary" id="createRoomBtn" style="margin-top:16px;">대화 시작</button>
        </div>
    </div>

    <!-- 초대 모달 -->
    <div class="modal-overlay" id="inviteModal" role="dialog" aria-modal="true" aria-labelledby="inviteModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="inviteModalTitle">멤버 초대</h3>
                <button class="modal-close" id="closeInviteModal">✕</button>
            </div>
            <div class="user-list" id="inviteUserList"></div>
            <button class="btn btn-primary" id="confirmInviteBtn" style="margin-top:16px;">초대하기</button>
        </div>
    </div>

    <!-- 멤버 보기 모달 -->
    <div class="modal-overlay" id="membersModal" role="dialog" aria-modal="true" aria-labelledby="membersModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="membersModalTitle">👥 대화방 멤버</h3>
                <button class="modal-close" id="closeMembersModal">✕</button>
            </div>
            <div class="members-info" id="membersInfo">
                <div class="members-count"></div>
            </div>
            <div class="user-list members-list" id="membersList"></div>
            <div class="modal-footer" style="margin-top:16px; display:flex; gap:8px;">
                <button class="btn btn-secondary" id="closeMembersBtn" style="flex:1;">닫기</button>
                <button class="btn btn-danger" id="leaveFromMembersBtn" style="flex:1;">🚪 대화방 나가기</button>
            </div>
        </div>
    </div>

    <!-- 프로필 수정 모달 -->
    <div class="modal-overlay" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="profileModalTitle">⚙ 프로필 수정</h3>
                <button class="modal-close" id="closeProfileModal">✕</button>
            </div>
            <div class="modal-tabs">
                <button class="modal-tab active" data-tab="profile">프로필 정보</button>
                <button class="modal-tab" data-tab="security">계정 보안</button>
            </div>

            <!-- 탭 1: 프로필 정보 -->
            <div id="tab-profile" class="tab-content active">
                <div class="profile-edit-content">
                    <div class="profile-image-section">
                        <div class="profile-image-preview" id="profileImagePreview">
                            <span id="profileInitial"></span>
                        </div>
                        <input type="file" id="profileImageInput" accept="image/*,.heic,.heif" style="display:none;">
                        <div class="profile-image-buttons">
                            <button class="btn btn-secondary" id="changeProfileImageBtn">📷 사진 변경</button>
                            <button class="btn btn-danger" id="deleteProfileImageBtn">🗑 기본 이미지</button>
                        </div>
                    </div>
                    <div class="profile-form">
                        <div class="form-group">
                            <label for="profileNickname">닉네임</label>
                            <input type="text" id="profileNickname" maxlength="20" placeholder="닉네임 입력">
                        </div>
                        <div class="form-group">
                            <label for="profileStatusMessage">상태 메시지</label>
                            <input type="text" id="profileStatusMessage" maxlength="100" placeholder="상태 메시지 (선택사항)">
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="margin-top:16px;">
                    <button class="btn btn-primary" id="saveProfileBtn">💾 저장</button>
                </div>
            </div>

            <!-- 탭 2: 계정 보안 -->
            <div id="tab-security" class="tab-content">
                <div class="security-section">
                    <h4>🔒 비밀번호 변경</h4>
                    <div class="form-group">
                        <label>현재 비밀번호</label>
                        <input type="password" id="currentPassword" placeholder="현재 비밀번호">
                    </div>
                    <div class="form-group">
                        <label>새 비밀번호</label>
                        <input type="password" id="newPassword" placeholder="8자 이상 (영문+숫자)">
                    </div>
                    <div class="form-group">
                        <label>새 비밀번호 확인</label>
                        <input type="password" id="newPasswordConfirm" placeholder="새 비밀번호 확인">
                    </div>
                    <button class="btn btn-primary" id="changePasswordBtn">비밀번호 변경</button>
                </div>

                <hr style="border:0; border-top:1px solid var(--border); margin:24px 0;">

                <div class="security-section danger-zone">
                    <h4 style="color:var(--danger)">⚠️ 회원 탈퇴</h4>
                    <p style="font-size:13px; color:var(--text-muted); margin-bottom:12px;">
                        탈퇴 시 모든 대화방에서 나가며, 계정 정보가 영구적으로 삭제됩니다. 작성한 메시지는 보존됩니다.
                    </p>
                    <button class="btn btn-danger" id="deleteAccountBtn">회원 탈퇴</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 설정 모달 -->
    <div class="modal-overlay" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
        <div class="modal" style="max-width: 480px;">
            <div class="modal-header">
                <h3 id="settingsModalTitle">🎨 화면 설정</h3>
                <button class="modal-close" id="closeSettingsModal">✕</button>
            </div>
            <div class="settings-content">
                <!-- 테마 모드 -->
                <div class="settings-section">
                    <div class="settings-section-title">테마 모드</div>
                    <div class="theme-toggle">
                        <button class="theme-toggle-btn" data-theme="dark">🌙 다크</button>
                        <button class="theme-toggle-btn" data-theme="light">☀️ 라이트</button>
                        <button class="theme-toggle-btn" data-theme="system">💻 시스템</button>
                    </div>
                </div>

                <!-- 테마 색상 -->
                <div class="settings-section">
                    <div class="settings-section-title">테마 색상</div>
                    <div class="color-palette">
                        <div class="color-option" data-color="emerald" title="Emerald"></div>
                        <div class="color-option" data-color="ocean" title="Ocean"></div>
                        <div class="color-option" data-color="purple" title="Purple"></div>
                        <div class="color-option" data-color="rose" title="Rose"></div>
                        <div class="color-option" data-color="orange" title="Orange"></div>
                        <div class="color-option" data-color="cyan" title="Cyan"></div>
                        <div class="color-option" data-color="yellow" title="Yellow"></div>
                        <div class="color-option" data-color="indigo" title="Indigo"></div>
                        <div class="color-option" data-color="teal" title="Teal"></div>
                        <div class="color-option" data-color="pink" title="Pink"></div>
                    </div>
                </div>

                <!-- 채팅 배경 -->
                <div class="settings-section">
                    <div class="settings-section-title">채팅 배경</div>
                    <div class="bg-options">
                        <div class="bg-option" data-bg="none" title="없음">✕</div>
                        <div class="bg-option" data-bg="dots" title="도트"></div>
                        <div class="bg-option" data-bg="grid" title="그리드"></div>
                        <div class="bg-option" data-bg="gradient1" title="그라데이션"></div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title" id="languageSectionLabel">언어</div>
                    <select id="languageSelect" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text);">
                        <option value="auto">자동</option>
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer" style="margin-top:16px;">
                <button class="btn btn-secondary" id="resetSettingsBtn" style="margin-right:8px;">기본값</button>
                <button class="btn btn-primary" id="closeSettingsBtn">닫기</button>
            </div>
        </div>
    </div>

    <!-- 도움말 모달 -->
    <div class="modal-overlay" id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
        <div class="modal" style="max-width: 520px;">
            <div class="modal-header">
                <h3 id="helpModalTitle">❓ 도움말</h3>
                <button class="modal-close" id="closeHelpModal">✕</button>
            </div>
            <div class="help-content" style="max-height: 400px; overflow-y: auto;">
                <div class="help-section">
                    <h4>🔐 종단간 암호화 (E2E)</h4>
                    <p>모든 메시지는 종단간 암호화되어 서버에서도 내용을 볼 수 없습니다.</p>
                </div>
                <div class="help-section">
                    <h4>💬 기본 사용법</h4>
                    <ul>
                        <li><b>새 대화</b>: ➕ 버튼으로 새 대화 시작</li>
                        <li><b>메시지 전송</b>: Enter 키 또는 ✉ 버튼</li>
                        <li><b>줄바꿈</b>: Shift + Enter</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h4>🏷 @멘션</h4>
                    <p>메시지 입력 중 <code>@</code> 입력 후 닉네임 선택으로 특정 사용자 언급</p>
                </div>
                <div class="help-section">
                    <h4>📁 파일 업로드</h4>
                    <ul>
                        <li><b>드래그앤드롭</b>: 파일을 채팅창에 끌어놓기</li>
                        <li><b>붙여넣기</b>: Ctrl+V로 이미지 붙여넣기</li>
                        <li><b>첨부</b>: 📎 버튼 클릭</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h4>🖼 이미지 보기</h4>
                    <p>이미지 클릭 시 전체화면 보기. ←→ 키로 탐색, ESC로 닫기</p>
                </div>
                <div class="help-section">
                    <h4>↩ 답장</h4>
                    <p>메시지에 마우스를 올려 ↩ 버튼 클릭으로 답장</p>
                </div>
                <div class="help-section">
                    <h4>🎨 테마 설정</h4>
                    <p>🎨 버튼으로 다크/라이트 모드, 색상, 배경 변경</p>
                </div>
                <div class="help-section">
                    <h4>⌨️ 키보드 단축키</h4>
                    <ul>
                        <li><b><span class="kbd">Ctrl</span>+<span class="kbd">K</span></b>: 대화 검색</li>
                        <li><b><span class="kbd">Ctrl</span>+<span class="kbd">N</span></b>: 새 대화 시작</li>
                        <li><b><span class="kbd">Ctrl</span>+<span class="kbd">F</span></b>: 대화 내 검색</li>
                        <li><b><span class="kbd">ESC</span></b>: 모달/검색 닫기</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer" style="margin-top:16px;">
                <button class="btn btn-primary" id="closeHelpBtn">닫기</button>
            </div>
        </div>
    </div>

    <!-- 연결 상태 표시 -->
    <div class="connection-status" id="connectionStatus">
        <span class="status-dot"></span>
        <span class="status-text">연결 중...</span>
    </div>

    <!-- 이미지 라이트박스 -->
    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" onclick="closeLightbox()">✕</button>
        <button class="lightbox-nav lightbox-prev" onclick="prevImage()">◀</button>
        <img class="lightbox-content" id="lightboxImage" src="" alt="">
        <button class="lightbox-nav lightbox-next" onclick="nextImage()">▶</button>
    </div>

    <!-- v4.0 투표 생성 모달 -->
    <div class="modal-overlay" id="pollModal" role="dialog" aria-modal="true" aria-labelledby="pollModalTitle">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="pollModalTitle">📋 투표 만들기</h3>
                <button class="modal-close" id="closePollModal">✕</button>
            </div>
            <div class="form-group">
                <label>질문</label>
                <input type="text" id="pollQuestion" placeholder="투표 질문을 입력하세요" maxlength="200">
            </div>
            <div class="form-group">
                <label>옵션 <span class="option-count">(2~10개)</span></label>
                <div id="pollOptions">
                    <div class="poll-option-input"><input type="text" placeholder="옵션 1" maxlength="100"></div>
                    <div class="poll-option-input"><input type="text" placeholder="옵션 2" maxlength="100"></div>
                </div>
                <button class="btn btn-secondary btn-sm" id="addPollOption" style="margin-top:8px;">➕ 옵션 추가</button>
            </div>
            <div class="form-group checkbox-group">
                <label><input type="checkbox" id="pollMultiple"> 복수 선택 허용</label>
                <label><input type="checkbox" id="pollAnonymous"> 익명 투표</label>
            </div>
            <button class="btn btn-primary" id="createPollBtn" style="margin-top:16px;">투표 생성</button>
        </div>
    </div>

    <!-- v4.0 파일 저장소 모달 -->
    <div class="modal-overlay" id="filesModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3>📁 파일 저장소</h3>
                <button class="modal-close" id="closeFilesModal">✕</button>
            </div>
            <div class="file-filter-tabs">
                <button class="file-tab active" data-type="">전체</button>
                <button class="file-tab" data-type="image">🖼 사진</button>
                <button class="file-tab" data-type="file">📄 파일</button>
            </div>
            <div class="file-storage-list" id="fileStorageList">
                <div class="empty-files">파일이 없습니다</div>
            </div>
        </div>
    </div>

    <!-- v4.0 알림 설정 모달 -->
    <div class="modal-overlay" id="notificationSettingsModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h3>🔔 알림 설정</h3>
                <button class="modal-close" id="closeNotificationSettingsModal">✕</button>
            </div>
            <div class="notification-settings">
                <div class="setting-item">
                    <label for="notifyAll">
                        <input type="radio" name="notifyOption" id="notifyAll" value="all" checked>
                        <span>모든 메시지</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label for="notifyMention">
                        <input type="radio" name="notifyOption" id="notifyMention" value="mention">
                        <span>@멘션만</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label for="notifyNone">
                        <input type="radio" name="notifyOption" id="notifyNone" value="none">
                        <span>알림 끄기</span>
                    </label>
                </div>
                <div class="setting-item">
                    <label for="notifySound">
                        <input type="checkbox" id="notifySound" checked>
                        <span>알림 소리</span>
                    </label>
                </div>
            </div>
            <button class="btn btn-primary" id="saveNotificationSettings" style="margin-top:16px;">저장</button>
        </div>
    </div>

    <!-- v4.0 고급 검색 모달 -->
    <div class="modal-overlay" id="advancedSearchModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3>🔍 고급 검색</h3>
                <button class="modal-close" id="closeAdvancedSearchModal">✕</button>
            </div>
            <div class="form-group">
                <label>검색어</label>
                <input type="text" id="advSearchQuery" placeholder="검색할 내용">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>시작 날짜</label>
                    <input type="date" id="advSearchDateFrom">
                </div>
                <div class="form-group">
                    <label>종료 날짜</label>
                    <input type="date" id="advSearchDateTo">
                </div>
            </div>
            <div class="form-group">
                <label for="advSearchFileOnly">
                    <input type="checkbox" id="advSearchFileOnly">
                    <span>파일/이미지만</span>
                </label>
            </div>
            <button class="btn btn-primary" id="doAdvancedSearch" style="margin-top:16px;">검색</button>
            <div id="advancedSearchResults" class="search-results"
                style="margin-top:16px; max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>

    <!-- v4.0 관리자 설정 모달 -->
    <div class="modal-overlay" id="adminModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3>👑 관리자 설정</h3>
                <button class="modal-close" id="closeAdminModal">✕</button>
            </div>
            <div class="admin-settings">
                <div id="adminMemberList" class="user-list"></div>
            </div>
        </div>
    </div>

    <!-- 모듈화된 JavaScript 파일들 (의존성 순서대로 로딩) -->
    <script src="/static/js/utils.js?v=4.8"></script>
    <script src="/static/js/i18n.js?v=4.9"></script>
    <script src="/static/js/toast.js?v=4.8"></script>
    <script src="/static/js/theme.js?v=4.8"></script>
    <script src="/static/js/auth.js?v=4.8"></script>
    <script src="/static/js/profile.js?v=4.8"></script>
    <script src="/static/js/features.js?v=4.8"></script>
    <script src="/static/js/rooms.js?v=4.8"></script>
    <script src="/static/js/messages.js?v=4.8"></script>
    <script src="/static/js/socket-handlers.js?v=4.8"></script>

    <!-- 스토리지 및 알림 -->
    <script src="/static/js/storage.js?v=4.8"></script>
    <script src="/static/js/notification.js?v=4.8"></script>

    <!-- 메인 앱 (마지막) -->
    <script src="/static/js/app.js?v=4.8"></script>
</body>

</html>
